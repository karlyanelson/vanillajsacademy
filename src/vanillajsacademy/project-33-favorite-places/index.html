---
layout: layout_project.njk
title: "Project 33: Favorite Places"
tags: project
---
<main>
    <h1>{{title}}</h1>
    <p>Explore cool, quirky places in your own backyard.</p>
    <div id="app">Loading...</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/reefjs@7/dist/reef.js"></script>
<script>
;(function () {
  // Variables
  const favoriteIconOutline = `<svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
  </svg>`;

  const favoriteIconFilled = `<svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
  </svg>`;

  const storageID = "favoritePlaces";

  // Methods
  let app = new Reef("#app", {
    data: {},
    template: function (props) {
      if (props.error) {
        return props.error;
      }

      let storedData = JSON.parse(localStorage.getItem(storageID));

      props.places.forEach(function (place) {
        let matchingStoredPlace = storedData.data.filter(function (storedPlace) {
          if (place.id === storedPlace.id) {
            return storedPlace;
          }
        });

        if (matchingStoredPlace) {
          place.favorite = matchingStoredPlace[0].favorite;
        } else {
          place.favorite = false;
        }
      });

      return (
        "<div class='places'>" +
        props.places.map(function (place) {
            let icon = favoriteIconOutline;
            if (place.favorite) {
              icon = favoriteIconFilled;
            }

            return (
              "<article id='" +
                place.id +
              "'/>" +
                "<img alt='' src='" +
                  place.img +
                "'/>" +
                "<div class='place-text'>" +
                  "<h2>" +
                  "<a href='" +
                    place.url +
                  "'>" +
                    place.place +
                  "</a>" +
                  "</h2>" +
                  "<address class='place-location'>" +
                    place.location +
                  "</address>" +
                  "<p>" +
                    place.description +
                  "</p>" +
                  `<button aria-label='Favorite' class='fave-btn' aria-pressed='${place.favorite}'>${icon}</button>` +
                "</div>" +
              "</article>"
            );
          })
          .join("") +
        "</div>"
      );
    }
  });

  function checkResponse(response) {
    if (response.ok) {
      return response.json();
    } else {
      return Promise.reject(response);
    }
  }

  function handleError(error) {
    console.warn("Something went wrong:", error);
    app.data.error = "Sorry something went wrong with our API.";
  }

  function updateData(response) {
    app.data.places = response;
    return response;
  }

  function clickHandler(event) {
    if (event.target.closest("button")) {
      let place = event.target.closest("article");
      if (
        event.target.closest("button").getAttribute("aria-pressed") === "false"
      ) {
        favorite(place, true);
      } else {
        favorite(place, false);
      }
    }
  }

  function favorite(place, value) {
    let placeID = place.id;
    let favoritedPlaces = app.data.places.map(function (place) {
      if (!place.id) {
        return;
      }
      if (place.id === placeID) {
        place.favorite = value;
      }
      return place;
    });

    app.data.places = favoritedPlaces;
    storeData(favoritedPlaces);
  }

  function storeData(data) {
    let storedData = {
      data: data
    };

    localStorage.setItem(storageID, JSON.stringify(storedData));
  }

  // Events/Inits
  // Fetch data from the api
  fetch("https://vanillajsacademy.com/api/places.json")
    .then(checkResponse)
    .then(updateData)
    .catch(handleError);

  // Handle favoriting
  document.addEventListener("click", clickHandler);
})();


</script>